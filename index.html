<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>生成练习与二维码</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #qrcode { margin-top: 20px; }
    textarea { width: 100%; height: 100px; }
    .exercise { margin-top: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
  </style>
</head>
<body>
  <h2>输入练习句子</h2>
  <textarea id="sentenceInput" placeholder="请输入句子..."></textarea><br><br>
  <button onclick="generateExercise()">生成练习和二维码</button>

  <div id="exerciseContainer" class="exercise" style="display:none;">
    <h3>练习题</h3>
    <div id="exerciseContent"></div>
  </div>

  <div id="qrcode"></div>

  <script>
    function generateExercise() {
      const sentence = document.getElementById("sentenceInput").value.trim();
      if (!sentence) {
        alert("请输入句子！");
        return;
      }

      // 简单的练习生成逻辑：随机挖掉一个词
      const words = sentence.split(/[\s，。！？]/).filter(w => w.length > 0);
      if (words.length < 2) {
        alert("句子太短，无法生成练习。");
        return;
      }
      const randomIndex = Math.floor(Math.random() * words.length);
      const answer = words[randomIndex];
      const exerciseSentence = sentence.replace(answer, "____");

      // 在页面显示练习题
      const exerciseDiv = document.getElementById("exerciseContainer");
      document.getElementById("exerciseContent").innerHTML = `
        题目：${exerciseSentence}<br>
        (答案：${answer})
      `;
      exerciseDiv.style.display = "block";

      // 生成一个练习页面 URL（用 base64 编码句子和答案）
      const encoded = encodeURIComponent(btoa(JSON.stringify({
        q: exerciseSentence,
        a: answer
      })));
      const exerciseURL = window.location.origin + window.location.pathname + "?exercise=" + encoded;

      // 清空旧二维码
      document.getElementById("qrcode").innerHTML = "";
      // 生成新的二维码
      new QRCode(document.getElementById("qrcode"), {
        text: exerciseURL,
        width: 200,
        height: 200
      });

      console.log("练习页面URL：", exerciseURL);
    }

    // 学生端：如果 URL 中有练习参数，就直接进入练习模式
    window.onload = function() {
      const params = new URLSearchParams(window.location.search);
      if (params.has("exercise")) {
        const data = JSON.parse(atob(decodeURIComponent(params.get("exercise"))));
        document.body.innerHTML = `
          <h2>手机练习</h2>
          <p>题目：${data.q}</p>
          <input id="studentAnswer" placeholder="请输入答案">
          <button onclick="checkAnswer('${data.a}')">提交</button>
          <div id="feedback"></div>
        `;
      }
    }

    function checkAnswer(correct) {
      const userAns = document.getElementById("studentAnswer").value.trim();
      const feedback = document.getElementById("feedback");
      if (userAns === correct) {
        feedback.innerHTML = "<p style='color:green;'>✅ 答对了！</p>";
      } else {
        feedback.innerHTML = "<p style='color:red;'>❌ 错误。正确答案是：" + correct + "</p>";
      }
    }
  </script>
</body>
</html>
