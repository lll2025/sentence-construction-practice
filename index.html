<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>连词成句练习</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body {
      font-family: '楷体', sans-serif;
      background: linear-gradient(135deg, #f0f5f9 0%, #e0e8ed 100%);
      color: #333;
      padding: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }
    .section {
      background: rgba(255,255,255,0.9);
      border-radius: 20px;
      padding: 30px;
      width: 80%;
      max-width: 600px;
      margin-bottom: 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
    h2 {
      color: #555;
      text-align: center;
      margin-bottom: 20px;
    }
    textarea, input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-bottom: 20px;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: vertical;
    }
    button {
      background: #0099cc;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 25px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #0077a3;
    }
    #qrcode { margin-top: 15px; text-align: center; }
    #modules {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .module {
      width: 100px;
      height: 40px;
      background: #f4f4f4;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #words {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .word {
      padding: 10px 15px;
      background: #e6f2f7;
      border: 1px solid #0099cc;
      border-radius: 8px;
      cursor: pointer;
    }
    #finish-message {
      font-size: 24px;
      color: #0099cc;
      font-weight: bold;
      text-align: center;
      display: none;
    }
  </style>
</head>
<body>

  <!-- 老师输入区 -->
  <div id="input-section" class="section">
    <h2>老师：输入一组练习句子（一行一句）</h2>
    <textarea id="sentences-input" placeholder="例如：\n我 喜欢 学习 中文\n今天 天气 很 好"></textarea>
    <button id="generate-button">生成练习二维码</button>
    <div id="qrcode"></div>
  </div>

  <!-- 学生姓名输入 -->
  <div id="name-section" class="section" style="display:none;">
    <h2>学生：请输入姓名</h2>
    <input id="student-name" placeholder="姓名" />
    <button id="start-button">开始练习</button>
  </div>

  <!-- 练习区域 -->
  <div id="game-section" class="section" style="display:none;">
    <div id="modules"></div>
    <div id="words"></div>
    <button id="next-button" style="display:none;">下一题</button>
    <div id="finish-message">练习完成！</div>
  </div>

<script>
  // 你提供的 Google Apps Script 部署地址
  const SCRIPT_URL = "https://script.google.com/a/macros/nu.edu.kz/s/AKfycbzyJOO9BiMw2Wk57T_hjIDHx2lbY8U_spmvGY68Vo8Qz9ZZ3qcIJiWCXESiNt0hfuvWBg/exec";

  const inputSection = document.getElementById('input-section');
  const nameSection  = document.getElementById('name-section');
  const gameSection  = document.getElementById('game-section');
  const textarea     = document.getElementById('sentences-input');
  const qrcodeDiv    = document.getElementById('qrcode');
  const studentNameI = document.getElementById('student-name');
  const startBtn     = document.getElementById('start-button');
  const modulesDiv   = document.getElementById('modules');
  const wordsDiv     = document.getElementById('words');
  const nextBtn      = document.getElementById('next-button');
  const finishMsg    = document.getElementById('finish-message');

  let sentences = [], currentIndex = 0, groupID = '', studentName = '';

  // 老师生成练习二维码
  document.getElementById('generate-button').onclick = async () => {
    const lines = textarea.value.split('\n').map(s => s.trim()).filter(s => s);
    if (lines.length === 0) return alert('请输入至少一句句子！');
    const resp = await fetch(SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify({ sentences: lines }),
      headers: { "Content-Type": "application/json" }
    });
    const data = await resp.json();
    groupID = data.groupID;
    const url = window.location.href.split('?')[0] + '?group=' + groupID;
    qrcodeDiv.innerHTML = '';
    new QRCode(qrcodeDiv, { text: url, width: 200, height: 200 });
  };

  // 学生扫码进入
  window.onload = async () => {
    const params = new URLSearchParams(location.search);
    if (params.has('group')) {
      groupID = params.get('group');
      inputSection.style.display = 'none';
      nameSection.style.display = 'block';
    }
  };

  // 学生输入姓名后开始练习
  startBtn.onclick = () => {
    if (!studentNameI.value.trim()) return alert('请输入姓名');
    studentName = studentNameI.value.trim();
    nameSection.style.display = 'none';
    // 取句子
    fetch(SCRIPT_URL + '?group=' + groupID).then(r => r.json()).then(data => {
      sentences = data.sentences || [];
      nameSection.style.display = 'none';
      gameSection.style.display = 'block';
      showSentence();
    });
  };

  function showSentence() {
    if (currentIndex >= sentences.length) {
      modulesDiv.style.display = 'none';
      wordsDiv.style.display = 'none';
      nextBtn.style.display = 'none';
      finishMsg.style.display = 'block';
      return;
    }
    finishMsg.style.display = 'none';
    nextBtn.style.display = 'none';
    modulesDiv.innerHTML = '';
    wordsDiv.innerHTML = '';
    const sentence = sentences[currentIndex];
    const arr = sentence.split(/\s+/);
    const shuffled = arr.slice().sort(() => Math.random() - 0.5);
    arr.forEach(() => { let d = document.createElement('div'); d.className = 'module'; modulesDiv.appendChild(d); });
    shuffled.forEach(w => {
      let d = document.createElement('div');
      d.className = 'word';
      d.textContent = w;
      d.onclick = () => {
        const slot = Array.from(modulesDiv.children).find(s => s.textContent === '');
        if (slot) {
          slot.textContent = w;
          d.style.display = 'none';
          checkAnswer(arr);
        }
      };
      wordsDiv.appendChild(d);
    });
  }

  function checkAnswer(arr) {
    const filled = Array.from(modulesDiv.children).every(s => s.textContent);
    if (!filled) return;
    const user = Array.from(modulesDiv.children).map(s => s.textContent);
    const ok = user.join(' ') === arr.join(' ');
    if (ok) nextBtn.style.display = 'block';
    // 上传结果
    fetch(SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify({
        groupID, studentName, sentence: arr.join(' '),
        answer: user.join(' '), correct: ok, timestamp: new Date().toLocaleString()
      }),
      headers: {"Content-Type":"application/json"}
    }).catch(()=>{});
  }

  nextBtn.onclick = () => {
    currentIndex++;
    showSentence();
  };
</script>

</body>
</html>






